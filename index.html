<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The TikTok Effect on Song Lifecycles</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
        }
        .analysis-controls {
            display: flex;
            gap: 1rem;
            margin: 1.5rem 0;
            flex-wrap: wrap;
        }

        .analysis-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background 0.3s;
        }

        .analysis-btn:hover {
            background: #5568d3;
        }

        .analysis-controls select {
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
        }

        .analysis-results {
            background: #f9f9f9;
            padding: 1.5rem;
            border-radius: 6px;
            margin: 1.5rem 0;
            min-height: 100px;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .stat-card {
            background: white;
            padding: 1rem;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        .scrollable-table {
            overflow-x: auto;
            max-width: 100%;
        }

        .scrollable-table table {
            width: 100%;
            table-layout: auto;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .section {
            background: white;
            margin: 2rem 0;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h2 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }

        h3 {
            color: #764ba2;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }

        .hypothesis {
            background: #f0f4ff;
            padding: 1.5rem;
            border-left: 4px solid #667eea;
            margin: 1.5rem 0;
        }

        .song-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }

        .song-card {
            background: #f9f9f9;
            padding: 1.5rem;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .song-card h3 {
            margin-top: 0;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 2rem 0;
        }

        .factors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .factor-card {
            background: #f9f9f9;
            padding: 1rem;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }

        .factor-card h4 {
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }

        .data-table th, .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-table th {
            background: #667eea;
            color: white;
        }

        .data-table tr:hover {
            background: #f5f5f5;
        }

        footer {
            background: #333;
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
        }

        .methodology {
            background: #fff9e6;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }

        @media (max-width: 768px) {
            .song-comparison {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>The TikTok Effect on Song Lifecycles</h1>
        <p>A Multi-Factor Analysis of Hit Songs: 2010–2015 vs 2018–Present</p>
    </header>

    <div class="container">
        <div class="section">
            <h2>Research Question</h2>
            <div class="hypothesis">
                <strong>Hypothesis:</strong> Songs in the TikTok era (2018–present) experience accelerated rise times and shorter chart lifespans compared to the pre-TikTok era (2010–2015), driven by multiple factors including virality patterns, sonic characteristics, and marketing strategies.
            </div>
            <p>This project analyzes the lifecycle of hit songs across two distinct eras, examining five key drivers that influence chart performance:</p>
            <div class="factors-grid">
                <div class="factor-card">
                    <h4>1. Artist Baseline Popularity</h4>
                    <p>Pre-existing fanbase and recognition</p>
                </div>
                <div class="factor-card">
                    <h4>2. Sonic Features</h4>
                    <p>Danceability, tempo, energy levels</p>
                </div>
                <div class="factor-card">
                    <h4>3. Virality Timing</h4>
                    <p>Google Trends, social media spikes</p>
                </div>
                <div class="factor-card">
                    <h4>4. Marketing Strategy</h4>
                    <p>Music videos, remixes, playlist placement</p>
                </div>
                <div class="factor-card">
                    <h4>5. Release Context</h4>
                    <p>Timing and competitive landscape</p>
                </div>
            </div>
        </div>
            <div class="section">
                <h2>Selected Songs Data Preview</h2>
                <div class="scrollable-table">
                    <table id="chartsPreview" class="data-table">
                        <thead id="chartsPreviewHead"></thead>
                        <tbody id="chartsPreviewBody"></tbody>
                    </table>
                </div>
            </div>
            <div class="section">
                <div class="scrollable-table">
                    <table id="dataPreview" class="data-table">
                        <thead id="dataPreviewHead"></thead>
                        <tbody id="dataPreviewBody"></tbody>
                    </table>
                </div>
            </div>
            <div class="section">
                <h2>Dataset Analysis Dashboard</h2>
                
                <div class="analysis-controls">
                    <button id="analyzeBtn" class="analysis-btn">Analyze Full Dataset</button>
                    <select id="analysisType">
                        <option value="era-comparison">Era Comparison (Pre-2018 vs Post-2018)</option>
                        <option value="sonic-features">Sonic Features Distribution</option>
                        <option value="longevity-factors">Chart Longevity Factors</option>
                        <option value="peak-performance">Peak Position Analysis</option>
                    </select>
                </div>
                
                <div id="analysisResults" class="analysis-results">
                    <p style="color: #999;">Click "Analyze Full Dataset" to generate insights from your CSV files</p>
                </div>
                
                <div class="chart-container" id="dynamicChartContainer" style="display: none;">
                    <canvas id="dynamicChart"></canvas>
                </div>
            </div>
        <div class="section">
            <h2>Case Studies</h2>
            <div class="song-comparison">
                <div class="song-card">
                    <h3>Pre-TikTok Era</h3>
                    <h4>Rolling in the Deep</h4>
                    <p><strong>Artist:</strong> Adele</p>
                    <p><strong>Release:</strong> November 2010</p>
                    <p><strong>Peak Position:</strong> #1</p>
                    <p><strong>Weeks on Chart:</strong> 65 weeks</p>
                </div>
                <div class="song-card">
                    <h3>TikTok Era</h3>
                    <h4>Say So</h4>
                    <p><strong>Artist:</strong> Doja Cat</p>
                    <p><strong>Release:</strong> May 2020</p>
                    <p><strong>Peak Position:</strong> #1</p>
                    <p><strong>Weeks on Chart:</strong> 38 weeks</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Billboard Chart Trajectory Comparison</h2>
            <div class="chart-container">
                <canvas id="trajectoryChart"></canvas>
            </div>
            <p><em>Note: Chart positions are inverted (lower = better rank). Data shows how quickly songs rose to #1 and their subsequent decline patterns.</em></p>
        </div>

        <div class="section">
            <h2>Spotify Audio Features Analysis</h2>
            <div class="chart-container">
                <canvas id="audioFeaturesChart"></canvas>
            </div>
            <div class="methodology">
                <strong>Methodology:</strong> Audio features extracted via Spotify API. Danceability, energy, and valence scored 0-1. Tempo normalized to 0-1 scale for comparison.
            </div>
        </div>

        <div class="section">
            <h2>Lifecycle Metrics Comparison</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Rolling in the Deep (Pre-TikTok)</th>
                        <th>Say So (TikTok Era)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Weeks to Peak (#1)</td>
                        <td>17 weeks</td>
                        <td>17 weeks</td>
                    </tr>
                    <tr>
                        <td>Weeks at #1</td>
                        <td>7 weeks</td>
                        <td>1 week</td>
                    </tr>
                    <tr>
                        <td>Total Weeks on Chart</td>
                        <td>65 weeks</td>
                        <td>38 weeks</td>
                    </tr>
                    <tr>
                        <td>Average Weekly Rank</td>
                        <td>24.7</td>
                        <td>28.5</td>
                    </tr>
                    <tr>
                        <td>Decay Rate</td>
                        <td>Slower drop off</td>
                        <td>Faster drop off</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>Multi-Factor Evidence Matrix</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Factor</th>
                        <th>Rolling in the Deep</th>
                        <th>Say So</th>
                        <th>Impact on Lifecycle</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Artist Popularity</strong></td>
                        <td>Established (21 album success)</td>
                        <td>Emerging (breakout hit)</td>
                        <td>Adele's fanbase provided sustained chart presence</td>
                    </tr>
                    <tr>
                        <td><strong>Danceability</strong></td>
                        <td>0.727</td>
                        <td>0.787</td>
                        <td>Higher danceability correlated with viral dance challenges</td>
                    </tr>
                    <tr>
                        <td><strong>Virality Pattern</strong></td>
                        <td>Steady radio growth</td>
                        <td>TikTok dance challenge spike (Feb 2020)</td>
                        <td>TikTok drove rapid climb but shorter peak duration</td>
                    </tr>
                    <tr>
                        <td><strong>Marketing Events</strong></td>
                        <td>Grammy performance (Feb 2011), widespread radio</td>
                        <td>Nicki Minaj remix (May 2020), TikTok promotion</td>
                        <td>Traditional media extended longevity vs viral peaks</td>
                    </tr>
                    <tr>
                        <td><strong>Radio Support</strong></td>
                        <td>Heavy, sustained</td>
                        <td>Moderate, post-viral</td>
                        <td>Radio airplay sustained chart presence longer</td>
                    </tr>
                    <tr>
                        <td><strong>Release Context</strong></td>
                        <td>Album rollout, winter release</td>
                        <td>Singles-first, pre-pandemic release</td>
                        <td>Album context provided sustained promotional cycle</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>Key Findings</h2>
            <h3>1. Compressed Longevity</h3>
            <p>Both songs reached #1 in 17 weeks but Say So maintained peak position for only 1 week compared to 7 weeks for Rolling in the Deep. The viral nature of TikTok-driven discovery creates rapid awareness but shorter sustained interest.</p>

            <h3>2. The "Viral Spike" Pattern</h3>
            <p>TikTok-era songs show characteristic sharp peaks followed by steeper declines, while pre-TikTok hits display more gradual bell curves. This suggests platform-driven discovery favors novelty over sustained engagement.</p>

            <h3>3. Multi-Channel Marketing vs Single-Platform Virality</h3>
            <p>Rolling in the Deep benefited from coordinated radio, Grammy exposure, and album context—creating multiple touchpoints. Say So's TikTok virality drove rapid growth but required traditional marketing (remix, radio) to convert to sustained success.</p>

            <h3>4. Artist Baseline as Stabilizer</h3>
            <p>Adele's established fanbase provided a floor for chart performance, while Doja Cat's breakout status meant more volatility. Artist recognition moderates lifecycle curves regardless of era.</p>
        </div>

        <div class="section">
            <h2>Methodology & Data Sources</h2>
            <h3>Data Collection</h3>
            <ul style="margin-left: 2rem; margin-top: 1rem;">
                <li><strong>Billboard Charts:</strong> Hot 100 weekly rankings</li>
                <li><strong>Spotify API:</strong> Audio features (danceability, energy, tempo, valence)</li>
                <li><strong>Marketing Events:</strong> Music video releases, remix dates, major performances</li>
            </ul>

            <h3>Analysis Approach</h3>
            <p>Lifecycle metrics calculated from Billboard chart data. Rise speed measured as weeks to peak, decay rate calculated from peak to chart exit.</p>
        </div>

        <div class="section">
            <h2>Dataset</h2>
            <p>View the raw chart data used in this analysis:</p>
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <a href="charts.csv" download 
                style="display: inline-block; background: #667eea; color: white; padding: 0.75rem 1.5rem; 
                text-decoration: none; border-radius: 4px;">
                Download charts.csv
                </a>
                <a href="data.csv" download 
                style="display: inline-block; background: #764ba2; color: white; padding: 0.75rem 1.5rem; 
                text-decoration: none; border-radius: 4px;">
                Download data.csv
                </a>
            </div>
        </div>
    </div>

    <footer>
        <p>Data Journalism Project | 2025</p>
        <p>Sources: Billboard, Spotify, Google Trends, Wikipedia</p>
    </footer>

    <script>
        let chartsData = [];
        let songsData = [];
        let dynamicChart = null;

        // Load both datasets
        Papa.parse('charts.csv', {
            download: true,
            header: true,
            complete: function(results) {
                chartsData = results.data.filter(row => row.song && row.artist);
            }
        });

        Papa.parse('data.csv', {
            download: true,
            header: true,
            dynamicTyping: true,
            complete: function(results) {
                songsData = results.data.filter(row => row.name);
            }
        });

        document.getElementById('analyzeBtn').addEventListener('click', function() {
            const analysisType = document.getElementById('analysisType').value;
            const resultsDiv = document.getElementById('analysisResults');
            const chartContainer = document.getElementById('dynamicChartContainer');
            
            if (chartsData.length === 0 || songsData.length === 0) {
                resultsDiv.innerHTML = '<p style="color: red;">Data still loading, please try again...</p>';
                return;
            }
            
            switch(analysisType) {
                case 'era-comparison':
                    analyzeEraComparison(resultsDiv, chartContainer);
                    break;
                case 'sonic-features':
                    analyzeSonicFeatures(resultsDiv, chartContainer);
                    break;
                case 'longevity-factors':
                    analyzeLongevity(resultsDiv, chartContainer);
                    break;
                case 'peak-performance':
                    analyzePeakPerformance(resultsDiv, chartContainer);
                    break;
            }
        });

        function analyzeEraComparison(resultsDiv, chartContainer) {
            // Split charts data by era
            const preTikTok = chartsData.filter(row => {
                const year = new Date(row.date).getFullYear();
                return year >= 2010 && year <= 2015;
            });
            
            const tikTokEra = chartsData.filter(row => {
                const year = new Date(row.date).getFullYear();
                return year >= 2018;
            });
            
            // Calculate average weeks on chart
            const preTikTokAvg = calculateAverageWeeks(preTikTok);
            const tikTokAvg = calculateAverageWeeks(tikTokEra);
            
            resultsDiv.innerHTML = `
                <h3>Era Comparison Results</h3>
                <div class="stat-grid">
                    <div class="stat-card">
                        <div class="stat-value">${preTikTokAvg}</div>
                        <div class="stat-label">Pre-TikTok Avg Weeks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${tikTokAvg}</div>
                        <div class="stat-label">TikTok Era Avg Weeks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${((preTikTokAvg - tikTokAvg) / preTikTokAvg * 100).toFixed(1)}%</div>
                        <div class="stat-label">Reduction in Longevity</div>
                    </div>
                </div>
                <p><strong>Finding:</strong> Songs in the TikTok era spend ${preTikTokAvg - tikTokAvg} fewer weeks on chart on average, supporting the accelerated lifecycle hypothesis.</p>
            `;
            
            chartContainer.style.display = 'block';
            createBarChart(['Pre-TikTok (2010-2015)', 'TikTok Era (2018+)'], [preTikTokAvg, tikTokAvg], 'Average Weeks on Billboard Hot 100');
        }

        function analyzeSonicFeatures(resultsDiv, chartContainer) {
            // Get average sonic features by era
            const preTikTok = songsData.filter(row => row.year >= 2010 && row.year <= 2015);
            const tikTokEra = songsData.filter(row => row.year >= 2018);
            
            const avgDance = {
                pre: average(preTikTok.map(s => s.danceability)),
                tiktok: average(tikTokEra.map(s => s.danceability))
            };
            
            const avgEnergy = {
                pre: average(preTikTok.map(s => s.energy)),
                tiktok: average(tikTokEra.map(s => s.energy))
            };
            
            const avgTempo = {
                pre: average(preTikTok.map(s => s.tempo)),
                tiktok: average(tikTokEra.map(s => s.tempo))
            };
            
            resultsDiv.innerHTML = `
                <h3>Sonic Features Analysis</h3>
                <div class="stat-grid">
                    <div class="stat-card">
                        <div class="stat-value">${(avgDance.tiktok - avgDance.pre > 0 ? '+' : '')}${((avgDance.tiktok - avgDance.pre) * 100).toFixed(1)}%</div>
                        <div class="stat-label">Danceability Increase</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${(avgEnergy.tiktok - avgEnergy.pre > 0 ? '+' : '')}${((avgEnergy.tiktok - avgEnergy.pre) * 100).toFixed(1)}%</div>
                        <div class="stat-label">Energy Change</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${avgTempo.tiktok.toFixed(0)} BPM</div>
                        <div class="stat-label">TikTok Era Avg Tempo</div>
                    </div>
                </div>
                <p><strong>Finding:</strong> TikTok-era songs show ${avgDance.tiktok > avgDance.pre ? 'higher' : 'lower'} danceability, correlating with platform's dance challenge culture.</p>
            `;
            
            chartContainer.style.display = 'block';
            createRadarChart(
                ['Danceability', 'Energy', 'Valence', 'Tempo (normalized)'],
                [
                    [avgDance.pre, avgEnergy.pre, average(preTikTok.map(s => s.valence)), avgTempo.pre / 200],
                    [avgDance.tiktok, avgEnergy.tiktok, average(tikTokEra.map(s => s.valence)), avgTempo.tiktok / 200]
                ],
                ['Pre-TikTok', 'TikTok Era']
            );
        }

        function analyzeLongevity(resultsDiv, chartContainer) {
            // Group songs by total weeks on chart
            const songWeeks = {};
            chartsData.forEach(row => {
                const key = `${row.song}|${row.artist}`;
                songWeeks[key] = (songWeeks[key] || 0) + 1;
            });
            
            const allWeeks = Object.values(songWeeks);
            const avgWeeks = average(allWeeks);
            const maxWeeks = Math.max(...allWeeks);
            const minWeeks = Math.min(...allWeeks);
            
            resultsDiv.innerHTML = `
                <h3>Chart Longevity Distribution</h3>
                <div class="stat-grid">
                    <div class="stat-card">
                        <div class="stat-value">${avgWeeks.toFixed(1)}</div>
                        <div class="stat-label">Average Weeks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${maxWeeks}</div>
                        <div class="stat-label">Maximum Weeks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${minWeeks}</div>
                        <div class="stat-label">Minimum Weeks</div>
                    </div>
                </div>
                <p><strong>Finding:</strong> Chart longevity varies widely (${minWeeks}-${maxWeeks} weeks), with factors beyond virality determining staying power.</p>
            `;
            
            chartContainer.style.display = 'block';
            const distribution = createDistribution(allWeeks, 10);
            createBarChart(distribution.labels, distribution.counts, 'Distribution of Songs by Weeks on Chart');
        }

        function analyzePeakPerformance(resultsDiv, chartContainer) {
            // Analyze peak positions
            const peakCounts = {1: 0, '2-5': 0, '6-10': 0, '11-20': 0, '21+': 0};
            
            const songPeaks = {};
            chartsData.forEach(row => {
                const key = `${row.song}|${row.artist}`;
                const peak = parseInt(row['peak-rank']);
                if (!songPeaks[key] || peak < songPeaks[key]) {
                    songPeaks[key] = peak;
                }
            });
            
            Object.values(songPeaks).forEach(peak => {
                if (peak === 1) peakCounts[1]++;
                else if (peak <= 5) peakCounts['2-5']++;
                else if (peak <= 10) peakCounts['6-10']++;
                else if (peak <= 20) peakCounts['11-20']++;
                else peakCounts['21+']++;
            });
            
            const numberOnes = peakCounts[1];
            const topTen = peakCounts[1] + peakCounts['2-5'] + peakCounts['6-10'];
            
            resultsDiv.innerHTML = `
                <h3>Peak Position Analysis</h3>
                <div class="stat-grid">
                    <div class="stat-card">
                        <div class="stat-value">${numberOnes}</div>
                        <div class="stat-label">#1 Hits</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${topTen}</div>
                        <div class="stat-label">Top 10 Hits</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${((numberOnes / Object.keys(songPeaks).length) * 100).toFixed(1)}%</div>
                        <div class="stat-label">Chart-Toppers</div>
                    </div>
                </div>
                <p><strong>Finding:</strong> ${numberOnes} songs reached #1, representing ${((numberOnes / Object.keys(songPeaks).length) * 100).toFixed(1)}% of charting tracks.</p>
            `;
            
            chartContainer.style.display = 'block';
            createBarChart(
                ['#1', '#2-5', '#6-10', '#11-20', '#21+'],
                [peakCounts[1], peakCounts['2-5'], peakCounts['6-10'], peakCounts['11-20'], peakCounts['21+']],
                'Distribution of Peak Chart Positions'
            );
        }

        // Utility functions
        function calculateAverageWeeks(data) {
            const songWeeks = {};
            data.forEach(row => {
                const key = `${row.song}|${row.artist}`;
                songWeeks[key] = (songWeeks[key] || 0) + 1;
            });
            const weeks = Object.values(songWeeks);
            return (weeks.reduce((a, b) => a + b, 0) / weeks.length).toFixed(1);
        }

        function average(arr) {
            const filtered = arr.filter(x => x != null && !isNaN(x));
            return filtered.reduce((a, b) => a + b, 0) / filtered.length;
        }

        function createDistribution(data, bins) {
            const max = Math.max(...data);
            const binSize = Math.ceil(max / bins);
            const counts = new Array(bins).fill(0);
            const labels = [];
            
            for (let i = 0; i < bins; i++) {
                const start = i * binSize + 1;
                const end = (i + 1) * binSize;
                labels.push(`${start}-${end}`);
            }
            
            data.forEach(val => {
                const binIndex = Math.min(Math.floor((val - 1) / binSize), bins - 1);
                counts[binIndex]++;
            });
            
            return {labels, counts};
        }

        function createBarChart(labels, data, title) {
            if (dynamicChart) dynamicChart.destroy();
            
            const ctx = document.getElementById('dynamicChart').getContext('2d');
            dynamicChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: title,
                        data: data,
                        backgroundColor: 'rgba(102, 126, 234, 0.7)',
                        borderColor: '#667eea',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createRadarChart(labels, datasets, datasetLabels) {
            if (dynamicChart) dynamicChart.destroy();
            
            const ctx = document.getElementById('dynamicChart').getContext('2d');
            dynamicChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: datasetLabels[0],
                            data: datasets[0],
                            borderColor: '#764ba2',
                            backgroundColor: 'rgba(118, 75, 162, 0.2)'
                        },
                        {
                            label: datasetLabels[1],
                            data: datasets[1],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.2)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            min: 0,
                            max: 1
                        }
                    }
                }
            });
        }
        // Preview first 2 entries for specific songs
        Papa.parse('charts.csv', {
            download: true,
            header: true,
            complete: function(results) {
                const data = results.data;

                // Filter for the two songs and keep only first 2 entries each
                const filtered = [];
                const counts = {}; // track how many rows we have per song
                const targetSongs = [
                    { artist: 'Adele', song: 'Rolling In The Deep' },
                    { artist: 'Doja Cat Featuring Nicki Minaj', song: 'Say So' }
                ];

                for (const row of data) {
                    for (const target of targetSongs) {
                        if (row.artist === target.artist && row.song === target.song) {
                            counts[row.song] = counts[row.song] || 0;
                            if (counts[row.song] < 2) {
                                filtered.push(row);
                                counts[row.song]++;
                            }
                        }
                    }
                }

                // Populate table header
                const headRow = Object.keys(filtered[0]);
                const thead = document.getElementById('chartsPreviewHead');
                thead.innerHTML = '<tr>' + headRow.map(col => `<th>${col}</th>`).join('') + '</tr>';

                // Populate table body
                const tbody = document.getElementById('chartsPreviewBody');
                tbody.innerHTML = filtered.map(row => {
                    return '<tr>' + headRow.map(col => `<td>${row[col]}</td>`).join('') + '</tr>';
                }).join('');
            }
        });

        const songIds = [
            '1CkvWZme3pRgbzaxZnTl5X', // Rolling in the Deep
            '3Dv1eDb0MEgF93GpLXlucZ'  // Say So
        ];

        Papa.parse('data.csv', {
            download: true,
            header: true,
            complete: function(results) {
                const data = results.data.filter(row => songIds.includes(row.id));

                if (data.length === 0) return;

                const headRow = Object.keys(data[0]);

                // Populate header
                const thead = document.getElementById('dataPreviewHead');
                thead.innerHTML = '<tr>' + headRow.map(col => `<th>${col}</th>`).join('') + '</tr>';

                // Populate body
                const tbody = document.getElementById('dataPreviewBody');
                tbody.innerHTML = data.map(row => {
                    return '<tr>' + headRow.map(col => `<td>${row[col]}</td>`).join('') + '</tr>';
                }).join('');
            }
        });
        // Billboard Chart Trajectory
        const trajectoryCtx = document.getElementById('trajectoryChart').getContext('2d');
        new Chart(trajectoryCtx, {
            type: 'line',
            data: {
                labels: Array.from({length: 65}, (_, i) => i + 1),
                datasets: [{
                    label: 'Rolling in the Deep (2010-2011)',
                    data: [68,97,84,69,64,41,26,13,18,25,26,17,10,10,6,2,2,1,1,1,1,1,1,1,2,3,3,4,5,6,9,12,13,14,17,17,20,22,21,21,23,27,29,28,34,36,38,36,40,41,35,30,36,40,41,43,44,17,5,23,32,30,33,43,49],
                    borderColor: '#764ba2',
                    backgroundColor: 'rgba(118, 75, 162, 0.1)',
                    tension: 0.4
                }, {
                    label: 'Say So (2020)',
                    data: [95,77,92,73,67,58,51,33,16,19,14,9,7,8,5,5,6,1,2,2,5,4,4,6,6,6,9,18,21,27,33,33,43,47,46,40,48,47],
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        reverse: true,
                        min: 0,
                        max: 100,
                        title: {
                            display: true,
                            text: 'Billboard Chart Position (lower = better)'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Weeks on Chart'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                }
            }
        });

        // Audio Features Comparison
        const audioCtx = document.getElementById('audioFeaturesChart').getContext('2d');
        new Chart(audioCtx, {
            type: 'radar',
            data: {
                labels: ['Danceability', 'Energy', 'Valence (Mood)', 'Tempo (Normalised)', 'Speechiness'],
                datasets: [{
                    label: 'Rolling in the Deep',
                    data: [0.727, 0.76, 0.54, 0.321, 0.0297],
                    borderColor: '#764ba2',
                    backgroundColor: 'rgba(118, 75, 162, 0.2)',
                }, {
                    label: 'Say So',
                    data: [0.787, 0.673, 0.786, 0.364, 0.158],
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.2)',
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        min: 0,
                        max: 1,
                        ticks: {
                            stepSize: 0.2
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                }
            }
        });
    </script>
</body>
</html>